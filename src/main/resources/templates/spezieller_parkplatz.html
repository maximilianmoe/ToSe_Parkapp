<!DOCTYPE html>
<html xmlns:th="http://www.thymeleafe.org" lang="de-De">

<head>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
          integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <!-- NÖTIG um Interaktivität zu aktivieren-->
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
            integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous">
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
            integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous">
    </script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
            integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous">
    </script>
    <style>
        #green_square {
            background-color: greenyellow;
            text-align: center;
        }

        #orange_square {
            background-color: orange;
            text-align: center;
        }

        #red_square {
            background-color: red;
            text-align: center;
        }

        .hintergrund_bild {
            width: 100%;
            height: 400px;
        }

        #zeit_input {
            text-align: center;
        }

        .card-title {
            text-align: center;
        }

        .col {
            text-align: center;
        }

        #ueberschrift {
            text-align: center;
        }

        #btn {
            text-align: center;
            margin-bottom: 20px;
        }

        #farbe {
            text-align: center;
        }

        #popup {
            color: red;
        }

        #popup2 {
            color: red;
        }

        #popup3 {
            color: red;
        }
    </style>
</head>

<body>
<nav class="navbar navbar-expand-lg navbar-dark bg-dark" id="navbar">
    <a class="navbar-brand" href="#">{Logo}</a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <ul class="navbar-nav mr-auto">
            <li class="nav-item">
                <a class="nav-link" href="#">Home <span class="sr-only">(current)</span></a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="#">Profil</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="guthabenverwaltung.html">Guthaben</a>
            </li>
            <li class="nav-item dropdown">
                <a class="nav-link dropdown-toggle" href="login.html" id="navbarDropdown" role="button"
                   data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    Parkplätze
                </a>
                <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                    <a class="dropdown-item" href="#">Meine Parkplätze</a>
                    <a class="dropdown-item" href="parkplatz_hinzufügen.html">Parkplatz hinzufügen</a>
                    <a class="dropdown-item" href="parkplaetze.html">Alle Parkplätze</a>
                </div>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="#">Einstellungen</a>
            </li>
        </ul>
        <form class="form-inline my-2 my-lg-0">
            <input class="form-control mr-sm-2" type="search" placeholder="Search" aria-label="Search">
            <button class="btn btn-outline-info my-2 my-sm-0" type="submit">Search</button>
        </form>
    </div>
</nav>
<div class="container">
    <div class="card mb-3">
        <div class="hintergrund_bild" style="background-image: url('../static/images/parkplatz5.jpg');"></div>
        <div class="card-body">
            <h5 class="card-title">PLZ + Ort + Str. + Hausnummer</h5>
            <p class="card-text">Beschreibung: Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do
                eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud
                exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in
                reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint
                occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>
            <div>
                <p>Fahrzeugtypen:</p>
                <p>Parkgebühr:</p>
                <p>Strafgebühr:</p>
                <p>Parkhöchstdauer:</p>
            </div>
        </div>
        <form action="#" th:action="@{/reserve}" method="post">
            <select class="form-control" id="belegt">
                <option selected disabled>Ist der Parkplatz aktuell belegt?</option>
                <option value="1">Der Parkplatz ist frei</option>
                <option value="2">Der Parkplatz ist aktuell belegt, aber könnte auch demnächst wieder frei werden</option>
                <option value="3">Ich belege den Parkplatz</option>
            </select>
            <h5 id="ueberschrift">Parkplatz Reservieren:</h5>
            <div class="row">
                <div class="col">
                    <h6>Anfanngszeit & Datum:</h6>
                    <input type="datetime-local" id="datetime1" th:value="*{reservierung.start}" th:name="start" class="form-control" placeholder="Bsp.: 01.01.2020 10:00">
                    <span id="popup"></span>
                </div>
                <div class="col">
                    <h6>Endzeit & Datum:</h6>
                    <input type="datetime-local" id="datetime2" th:value="*{reservierung.ende}" th:name="ende" class="form-control" placeholder="Bsp.: 01.01.2020 13:00">
                    <span id="popup2"></span>
                </div>
            </div>
            <div class="row">
                <div class="col">
                    <div class="form-group">
                        <h6>Wollen Sie eine Erinnerungsmail erhalten?</h6>
                        <select id="question" class="form-control" th:name="reservierungChecked">
                            <option value="1">Ja!</option>
                            <option value="2">Nein!</option>
                        </select>
                    </div>
                </div>
                <div class="col">
                    <h6 id="mail_txt">Wann wollen Sie die Erinnerungsmail erhalten?</h6>
                    <input type="text" class="form-control" id="mail" placeholder="Bsp.: 01.01.2020 08:00">
                    <span id="popup3"></span>
                </div>
            </div>
            <div id="btn_row">
                <div id="btn">
                    <button type="submit" class="btn btn-outline-secondary btn-lg" id="submit_btn"
                            disabled>Parkplatz
                        Reservieren</button>
                </div>
            </div>
        </form>
        <div class="card-footer" id="farbe">
            <img th:src="@{images/parkplatz3.jpg}" src="../static/images/P_Symbol.png" alt="Private/Icon">
            <small class="text-muted"></small>
        </div>
    </div>
</div>
<script>
    /*
        Folgende Funktion sorgt dafür, dass wenn Nein! (man will keine Erinnerungsmail erhalten)
        ausgewählt wird das Input-Fenster zur Angabe der Zeit, wann man die Mail erhalten
        möchte ausgegraut/disabled wird.
        Der Zweite Teil sorgt dafür, dass dies auch wieder enabled wird, sobald Ja! ausgewählt wird.
        Der dritte Teil sorgt dafür, dass sich die Farbe des Footers abhängig von der Auswahl des
        Statuses automatisch ändert.
    */

    /*
        Hab erfolgreich die meisten Probleme behoben. Alter Code ist noch da ABER auskommentiert!
        Einziges mir AKTUELL bekanntes PROBLEM:
        Wenn in 3.datetime input feld ('#mail') schon etwas im falschen Format eingegeben wurde und dann
        im Nachhinein noch Nein! ausgewählt wird, so bleibt das geschriebene im falschen Format in dem
        Feld und das Feld ist nicht mehr zugänig. (Gelöst!!)
        Neuer Fehler: Button wird nicht mehr aktiviert da @param: count nur 2 annimmt und nicht mehr 3.
        ---> YESSSS!!
        ---> Jetzt auch gelöst!
    */

    $(document).ready(function () {
        $('#question').change(function () {
            if ($(this).find('option:selected').text() == 'Nein!') {
                $('#mail').prop('disabled', true);
                $('#mail_txt').css('color', 'lightgrey');
                //$('#submit_btn').prop('disabled', false);
                $('#popup3').html("");
                var input_check = $('#mail').val();
                if(input_check.length > 0){
                    input_check = "";
                    $('#mail').val(input_check);
                }
            }
        });
        $('#question').change(function () {
            if ($(this).find('option:selected').text() == 'Ja!') {
                $('#mail').prop('disabled', false);
                $('#mail_txt').css('color', 'black');
            }
        });
        $('#belegt').change(function () {
            if ($(this).find('option:selected').text() == 'Der Parkplatz ist frei') {
                //$('#farbe').attr("green_square");
                //jQuery("div").prev("farbe").attr("id", "green_square");
                $(".card-footer").attr('id', 'green_square');
            }
            if ($(this).find('option:selected').text() ==
                'Der Parkplatz ist aktuell belegt, aber könnte auch demnächst wieder frei werden') {
                $(".card-footer").attr('id', 'orange_square');
            }
            if ($(this).find('option:selected').text() == 'Ich belege den Parkplatz') {
                $(".card-footer").attr('id', 'red_square');
            }
        });
        var check1 = 0;
        var check2 = 0;
        var check3 = 0;
        var count = 0;
        $('#datetime1').focusout(function () {
            var expression = /\b[0-9]{2}[.][0-9]{2}[.][0-9]{4}\b\s\b[0-9]{2}[:][0-9]{2}\b/g;
            var regex = new RegExp(expression);
            var datetime = $('#datetime1').val();
            if (datetime.match(regex)) {
                //$('#submit_btn').prop('disabled', false);
                $('#popup').html("");
                check1 = 1;
                count += check1;
            }
            //else if ($('#datetime1').val().length === 0){
            //    empty_check += 1;
            //}
            else {
                //alert('Anfangszeit muss in dem Format 01.01.2020 10:00 angegeben werden!');
                $('#popup').html(
                    "Anfangszeit muss in dem Format 01.01.2020 10:00 angegeben werden!");
                $('#submit_btn').prop('disabled', true);
            }
        });

        $('#datetime2').focusout(function () {
            var expression =
                /\b[0-9]{2}[.][0-9]{2}[.][0-9]{4}\b\s\b[0-9]{2}[:][0-9]{2}\b/g;
            var regex = new RegExp(expression);
            var datetime = $('#datetime2').val();
            if (datetime.match(regex)) {
                //$('#submit_btn').prop('disabled', false);
                $('#popup2').html("");
                check2 = 1;
                count += check2;
            }
            //else if ($('#datetime2').val().length === 0){
            //    empty_check += 1;
            //}
            else {
                //alert('Anfangszeit muss in dem Format 01.01.2020 10:00 angegeben werden!');
                $('#popup2').html(
                    "Endzeit muss in dem Format 01.01.2020 10:00 angegeben werden!");
                $('#submit_btn').prop('disabled', true);
            }
        });

        $('#mail').focusout(function () {
            var expression = /\b[0-9]{2}[.][0-9]{2}[.][0-9]{4}\b\s\b[0-9]{2}[:][0-9]{2}\b/g;
            var regex = new RegExp(expression);
            var datetime = $('#mail').val();
            if (datetime.match(regex)) {
                //$('#submit_btn').prop('disabled', false);

                $('#popup3').html("");
                check3 = 1;
                count += check3;
            }
            //else if ($('#datetime1').val().length === 0){
            //    empty_check += 1;
            //}
            else {
                //alert('Anfangszeit muss in dem Format 01.01.2020 10:00 angegeben werden!');
                $('#popup3').html(
                    "Erinnerungszeit muss in dem Format 01.01.2020 10:00 angegeben werden!");
                $('#submit_btn').prop('disabled', true);
            }
        });
        /*
        $('#submit_btn').hover(function(){
            if (count == 3) {
                $('#submit_btn').prop('disabled', false);
                alert(count);
            } else {
                alert(count);
            }
        });
        */
        $('#mail').focusout(function () {
            if (count == 3) {
                $('#submit_btn').prop('disabled', false);
            }
            //else {
            //  alert(count + 'Es ist leider ein Fehler aufgetreten!');
            //}
        });
        $('#datetime1').focusout(function () {
            if (count == 3) {
                $('#submit_btn').prop('disabled', false);
            }
            else if(count ==2 && $('#question').find('option:selected').text() == 'Nein!'){
                $('#submit_btn').prop('disabled', false);
            }
        });
        $('#datetime2').focusout(function () {
            if (count == 3) {
                $('#submit_btn').prop('disabled', false);
            }
            else if(count ==2 && $('#question').find('option:selected').text() == 'Nein!'){
                $('#submit_btn').prop('disabled', false);
            }
        });
        $('#question').focusout(function(){
            if(count == 3){
                $('#submit_btn').prop('disabled', false);
            }
            else if(count ==2 && $('#question').find('option:selected').text() == 'Nein!'){
                $('#submit_btn').prop('disabled', false);
            }
        });
        $('#btn_row').hover(function(){
            if(count == 3){
                $('#submit_btn').prop('disabled', false);
            }
            else if(count ==2 && $('#question').find('option:selected').text() == 'Nein!'){
                $('#submit_btn').prop('disabled', false);
            }
        });

    });
    /*
        //Alter Code mit Fehlern:

        $('#datetime1').focusout(function () {
            var expression = /\b[0-9]{2}[.][0-9]{2}[.][0-9]{4}\b\s\b[0-9]{2}[:][0-9]{2}\b/g;
            var regex = new RegExp(expression);
            var datetime = $('#datetime1').val();
            if (datetime.match(regex)) {
                //$('#submit_btn').prop('disabled', false);
                $('#popup').html("");
            } else {
                //alert('Anfangszeit muss in dem Format 01.01.2020 10:00 angegeben werden!');
                $('#popup').html("Anfangszeit muss in dem Format 01.01.2020 10:00 angegeben werden!");
                $('#submit_btn').prop('disabled', true);
            }
        });
        $('#datetime2').focusout(function () {
            var expression = /\b[0-9]{2}[.][0-9]{2}[.][0-9]{4}\b\s\b[0-9]{2}[:][0-9]{2}\b/g;
            var regex = new RegExp(expression);
            var datetime = $('#datetime2').val();
            if (datetime.match(regex)) {
                //$('#submit_btn').prop('disabled', false);
                $('#popup2').html("");
            } else {
                //alert('Anfangszeit muss in dem Format 01.01.2020 10:00 angegeben werden!');
                $('#popup2').html("Endzeit muss in dem Format 01.01.2020 10:00 angegeben werden!");
                //$('#submit_btn').prop('disabled', true);
            }
        });


        $('#mail').focusout(function () {
            var expression = /\b[0-9]{2}[.][0-9]{2}[.][0-9]{4}\b\s\b[0-9]{2}[:][0-9]{2}\b/g;
            var regex = new RegExp(expression);
            var datetime = $('#mail').val();
            if (datetime.match(regex)) {
                //$('#submit_btn').prop('disabled', false);

                $('#popup3').html("");
            } else {
                //alert('Anfangszeit muss in dem Format 01.01.2020 10:00 angegeben werden!');
                $('#popup3').html("Erinnerungszeit muss in dem Format 01.01.2020 10:00 angegeben werden!");
                //$('#submit_btn').prop('disabled', true);
            }
        });

    */

    /*
        PROBLEM!!!!!!
        Wenn Input #mail schon etwas falsches eingegeben wurde und danach erst auf NEIN! geändert wird.
        Wird das Feld zwar deaktiviert, aber roter text ist noch da und der Submit button bleibt auch
        disabled, obwohl keine Eingabve mehr möglich ist

        UPDATE:

        Geht jetzt doch habe in erster funktion, wenn nein! ausgewählt wird
        $('#submit_btn').prop('disabled', false);
                $('#popup3').html("");
        hinzugefügt.
        Neuer Fehler immer wenn NEIN! ausgewählt wird, wird submit button aktiviert egal was
        noch falsch oder leer ist!
    */

    /*
            $('#mail').focusout(function(){
                var expression = /\b[0-9]{2}[.][0-9]{2}[.][0-9]{4}\b\s\b[0-9]{2}[:][0-9]{2}\b/g;
                var regex = new RegExp(expression);
                var datetime = $('#mail').val();
                if($('#mail').is(':disabled')){
                    $('#submit_btn').prop('disabled', false);
                    $('#popup3').html("");
                }
                else if(datetime.match(regex)){
                    $('#submit_btn').prop('disabled', false);
                    $('#popup3').html("");
                }
                else{
                    //alert('Anfangszeit muss in dem Format 01.01.2020 10:00 angegeben werden!');
                    $('#popup3').html("Erinnerungszeit muss in dem Format 01.01.2020 10:00 angegeben werden!");
                    $('#submit_btn').prop('disabled', true);
                }
            });
    */
    /*
    $(document).on("submit", "form", function(e){
        var expression = /\b[0-9]{2}[.][0-9]{2}[.][0-9]{4}\b\s\b[0-9]{2}[:][0-9]{2}\b/g;
        var regex = new RegExp(expression);
        var datetime = $('#datetime1').val();
        if(!datetime.match(regex)){
            alert(alter);
            $('#popup').html("Anfangszeit muss in dem Format 01.01.2020 10:00 angegeben werden!");
        }
    });
*/

    /*

            Hat leider nicht so funktioniert, wie ich das wollte

            $('#submit_btn').hover(function(){
                var expression = /\b[0-9]{2}[.][0-9]{2}[.][0-9]{4}\b\s\b[0-9]{2}[:][0-9]{2}\b/g;
                var regex = new RegExp(expression);
                var datetime = $('#datetime1').val();
                var datetime_1 = $('#datetime2').val();
                var datetime_2 = $('#mail').val();
                if(!datetime.match(regex) && !datetime_1.match(regex) && !datetime_2.match(regex)){
                    $('#popup').html("Anfangszeit muss in dem Format 01.01.2020 10:00 angegeben werden!");
                    $('#popup2').html("Endszeit muss in dem Format 01.01.2020 10:00 angegeben werden!");
                    $('#popup3').html("Erinnerungszeit muss in dem Format 01.01.2020 10:00 angegeben werden!");
                    $('#submit_btn').prop('disabled', true);
                }
                else if (!datetime.match(regex) && !datetime_1.match(regex) && datetime_2.match(regex)) {
                    $('#popup').html("Anfangszeit muss in dem Format 01.01.2020 10:00 angegeben werden!");
                    $('#popup2').html("Endszeit muss in dem Format 01.01.2020 10:00 angegeben werden!");
                    $('#popup3').html("");
                    $('#submit_btn').prop('disabled', true);
                }
                else if (!datetime.match(regex) && datetime_1.match(regex) && !datetime_2.match(regex)){
                    $('#popup').html("Anfangszeit muss in dem Format 01.01.2020 10:00 angegeben werden!");
                    $('#popup2').html("");
                    $('#popup3').html("Erinnerungszeit muss in dem Format 01.01.2020 10:00 angegeben werden!");
                    $('#submit_btn').prop('disabled', true);
                }
                else if (datetime.match(regex) && !datetime_1.match(regex) && !datetime_2.match(regex)){
                    $('#popup').html("");
                    $('#popup2').html("Endszeit muss in dem Format 01.01.2020 10:00 angegeben werden!");
                    $('#popup3').html("Erinnerungszeit muss in dem Format 01.01.2020 10:00 angegeben werden!");
                    $('#submit_btn').prop('disabled', true);
                }
                else if (datetime.match(regex) && datetime_1.match(regex) && !datetime_2.match(regex)){
                    $('#popup').html("");
                    $('#popup2').html("");
                    $('#popup3').html("Erinnerungszeit muss in dem Format 01.01.2020 10:00 angegeben werden!");
                    $('#submit_btn').prop('disabled', true);
                }
                else if (datetime.match(regex) && !datetime_1.match(regex) && datetime_2.match(regex)){
                    $('#popup').html("");
                    $('#popup2').html("Endszeit muss in dem Format 01.01.2020 10:00 angegeben werden!");
                    $('#popup3').html("");
                    $('#submit_btn').prop('disabled', true);
                }
                else if (!datetime.match(regex) && datetime_1.match(regex) && datetime_2.match(regex)){
                    $('#popup').html("Anfangszeit muss in dem Format 01.01.2020 10:00 angegeben werden!");
                    $('#popup2').html("");
                    $('#popup3').html("");
                    $('#submit_btn').prop('disabled', true);
                }
                else if (datetime.match(regex) && datetime_1.match(regex) && datetime_2.match(regex)){
                    $('#popup').html("");
                    $('#popup2').html("");
                    $('#popup3').html("");
                    $('#submit_btn').prop('disabled', false);
                }
            });

    */
</script>
</body>

</html>